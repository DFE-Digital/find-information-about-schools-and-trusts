@page "/trusts/ofsted/single-headline-grades"
@model SingleHeadlineGradesModel

@{
  Layout = "Ofsted/_OfstedLayout";
}

<section class="app-table-container" data-testid="ofsted-single-headline-grades-school-name-table">
  <p class="govuk-body">The following grades are taken from the current and previous full inspection.</p>
  <details class="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text" data-testid="why-single-headline-not-available">
        Why a single headline grade might not be available
      </span>
    </summary>
    <div class="govuk-details__text">
      <p class="govuk-body">
        From <strong class="govuk-!-font-weight-bold">2 September 2024</strong>, Ofsted stopped giving a single headline
        grade for state-funded school inspections.
      </p>
      <p class="govuk-body">
        Inspections completed after this date are broken down by category.
      </p>
      <p class="govuk-body">
        You can see these on the ‘Current ratings’ and ‘Previous ratings’ pages.
      </p>
    </div>
  </details>
  <details class="govuk-details">
    <summary class="govuk-details__summary">
      <span class="govuk-details__summary-text" data-testid="where-to-find-short-inspection-data">
        Where to find short inspection data
      </span>
    </summary>
    <div class="govuk-details__text">
      <p class="govuk-body">
        If a school has a short Ofsted inspection followed by a full one, data about the short inspection may not appear on this page.
      </p>
      <p class="govuk-body">
        Ofsted's inspection report will contain this data.
      </p>
    </div>
  </details>
  <hr class="govuk-section-break govuk-section-break--m">
  <table class="govuk-table" data-module="moj-sortable-table" aria-describedby="ofsted-caption">
    <caption id="ofsted-caption" class="govuk-table__caption govuk-table__caption--m" data-testid="subpage-header">Single headline grades</caption>
    <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header govuk-body" aria-sort="ascending"
          data-testid="ofsted-single-headline-grades-school-name-header">
        School name
      </th>
      <th scope="col" class="govuk-table__header govuk-body column-header-date" aria-sort="none"
          data-testid="ofsted-single-headline-grades-date-joined-header">
        Date joined
      </th>
      <th scope="col" class="govuk-table__header govuk-body" aria-sort="none" data-testid="ofsted-single-headline-grades-has-recent-short-inspection">
        Has recent short inspection
      </th>
      <th scope="col" class="govuk-table__header govuk-body column-header-ofsted-single-headline-grade" aria-sort="none"
          data-testid="ofsted-single-headline-grades-current-single-headline-grade-header">
        Current single headline grade
      </th>
      <th scope="col" class="govuk-table__header govuk-body column-header-date" aria-sort="none"
          data-testid="ofsted-single-headline-grades-date-of-current-inspection-header">
        Date of current inspection
      </th>
      <th scope="col" class="govuk-table__header govuk-body column-header-ofsted-single-headline-grade" aria-sort="none"
          data-testid="ofsted-single-headline-grades-previous-single-headline-grade-header">
        Previous single headline grade
      </th>
      <th scope="col" class="govuk-table__header govuk-body column-header-date" aria-sort="none"
          data-testid="ofsted-single-headline-grades-date-of-previous-inspection-header">
        Date of previous inspection
      </th>
    </tr>
    </thead>
    <tbody class="govuk-table__body">
    @foreach (var academy in Model.Academies)
    {
      <tr class="govuk-table__row" data-testid="academy-row">
        <td class="govuk-table__cell govuk-body" data-sort-value="@academy.EstablishmentName" data-testid="ofsted-single-headline-grades-school-name">
          <partial name="Trusts/_AcademyLink" model="@new AcademyLinkModel(academy.EstablishmentName, academy.Urn)" />
        </td>
        <td class="govuk-table__cell govuk-body" data-sort-value="@academy.DateAcademyJoinedTrust!.Value.ToString(StringFormatConstants.SortableDateFormat)" data-testid="ofsted-single-headline-grades-date-joined">
          @academy.DateAcademyJoinedTrust!.Value.ToString(StringFormatConstants.DisplayDateFormat)
        </td>
        <td class="govuk-table__cell govuk-body" data-sort-value="@academy.HasRecentShortInspection" data-testid="ofsted-single-headline-grades-has-recent-short-inspection">
          @(academy.HasRecentShortInspection ? "Yes" : "No")
        </td>
        <partial name="_SingleHeadlineGradeCells" model="new SingleHeadlineGradeCellsModel(academy.CurrentOfstedRating, academy.WhenDidCurrentInspectionHappen, true)"/>
        <partial name="_SingleHeadlineGradeCells" model="new SingleHeadlineGradeCellsModel(academy.PreviousOfstedRating, academy.WhenDidPreviousInspectionHappen, false)"/>
      </tr>
    }
    </tbody>
  </table>
</section>
